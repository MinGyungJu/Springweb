<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserDAO">
	
	
	<select id="checkMId" parameterType="ManagerVO" resultType="ManagerVO">
		SELECT * FROM MANAGER
		 WHERE id=#{id}
	</select>	
	<select id="loginManager" parameterType="ManagerVO" resultType="ManagerVO">
		SELECT * FROM MANAGER
		 WHERE id=#{id} AND pw=#{pw}
	</select>

	<select id="checkId" parameterType="CustomerVO" resultType="CustomerVO">
		SELECT * FROM CUSTOMER
		 WHERE id=#{id}
	</select>	
	<select id="loginCustomer" parameterType="CustomerVO" resultType="CustomerVO">
		SELECT cno, name, gender, id, pw, tel, email, addr
		FROM CUSTOMER
		WHERE id=#{id} AND pw=#{pw}
	</select>
	<select id="selectCart" parameterType="ListOrderVO" resultType="ListOrderVO">
		SELECT ocnt
		FROM LIST_ORDER
		WHERE pno=#{pno} AND cno=#{cno}
	</select>
	<select id="getProductList" resultType="ProductVO">
		<![CDATA[
		SELECT * FROM PRODUCT
		WHERE PNO < 100000
		ORDER BY pno desc
		 ]]>
	</select>
	<select id="getProductList2" resultType="ProductVO">
		<![CDATA[
		SELECT * FROM PRODUCT
		WHERE PNO >= 100000
		ORDER BY pno desc
		 ]]>
	</select>
	<select id="getQuestionList" resultType="QuestionVO">
		SELECT * FROM QUESTION
		WHERE qno NOT IN (SELECT qno FROM ANSWER)
	</select>
	<select id="getQuestionAnswer" parameterType="int" resultType="hashmap">
		SELECT Q.qno qno, Q.qname qname, Q.qmessage qmessage, A.amessage amessage
		FROM question Q LEFT OUTER JOIN answer A
		ON Q.qno = A.qno
        WHERE Q.cno = #{cno}
        ORDER BY Q.qno desc
	</select>
	<select id="getOrdersList" parameterType="int" resultType="hashmap">
		SELECT P.img img, P.pname pname, P.price price, O.ocnt ocnt, O.lono lono
		FROM product P inner join orders O 
		ON P.pno = O.pno
		WHERE O.lono in (SELECT lono from finished_order WHERE cno = #{cno})
		ORDER BY lono desc
	</select>
	<select id="getCustomersOrders" resultType="hashmap">
		SELECT F.lono lono, F.cno cno, P.pname pname, O.ocnt ocnt
		FROM Finished_order F inner join Orders O
		ON F.lono = O.lono inner join Product P
		ON O.pno = P.pno
		ORDER BY lono desc
	</select>
	<select id="getCartList" parameterType="ListOrderVO" resultType="hashmap" >
		select P.img as img, P.pname as pname, P.price as price, O.ocnt as ocnt, O.pno as pno
		from product P inner join list_order O
		on P.pno = O.pno
		where O.cno = #{cno}
	</select>
	<select id="selectLono" resultType="integer">
		select finished_order_seq.nextval FROM DUAL
	</select>
	
	<update id="modifyProduct" parameterType="ProductVO">
		UPDATE PRODUCT 
		SET img=#{img}, pname=#{pname},price=#{price},description=#{description},stock=#{stock}
		WHERE pno=#{pno}
	</update>
	<update id="updateCart" parameterType="ListOrderVO">
		UPDATE LIST_ORDER
		SET ocnt = #{ocnt}
		WHERE pno=#{pno} AND cno=#{cno}
	</update>
	<update id="stock" parameterType="hashmap">
	 	UPDATE Product
	 	SET stock = stock - #{ocnt}
	 	WHERE pno = #{pno}
	</update>
	
	<delete id="deleteProduct" parameterType="ProductVO">
		DELETE FROM PRODUCT
		WHERE pno=#{pno}
	</delete>
	<delete id="removeCart" parameterType="ListOrderVO">
		DELETE FROM LIST_ORDER
		WHERE pno=#{pno} AND cno=#{cno}
	</delete>
	<delete id="deleteCart" parameterType="ListOrderVO">
		DELETE FROM LIST_ORDER
		WHERE cno=#{cno}
	</delete>
	<delete id="deleteOrder" parameterType="integer">
		DELETE FROM FINISHED_ORDER
		WHERE lono=#{lono}
	</delete>
	<delete id="deleteOrders" parameterType="integer">
		DELETE FROM ORDERS
		WHERE lono=#{lono}
	</delete>
	<insert id="insertAnswer" parameterType="AnswerVO">
		INSERT INTO ANSWER(qno,mno,cno,amessage)
		 VALUES(#{qno},#{mno},#{cno},#{amessage})
	</insert>
	<insert id="insertProduct" parameterType="ProductVO">
		<if test="img != null">
		INSERT INTO PRODUCT(pno, img, pname, price, description, stock) 
		 VALUES(product_seq.nextval,#{img},#{pname},#{price},#{description},#{stock})
		</if>
		<if test="img == null"> <!-- DELETE THIS LATER WHEN IMG WORKS -->
		INSERT INTO PRODUCT(pno, pname, price, description, stock) 
		 VALUES(product_seq.nextval,#{pname},#{price},#{description},#{stock})
		</if>
	</insert>
	<insert id="insertProduct2" parameterType="ProductVO">
		<if test="img != null">
		INSERT INTO PRODUCT(pno, img, pname, price, description, stock) 
		 VALUES(product2_seq.nextval,#{img},#{pname},#{price},#{description},#{stock})
		</if>
		<if test="img == null"> <!-- DELETE THIS LATER WHEN IMG WORKS -->
		INSERT INTO PRODUCT(pno, pname, price, description, stock) 
		 VALUES(product2_seq.nextval,#{pname},#{price},#{description},#{stock})
		</if>
	</insert>
	<insert id="insertManager" parameterType="ManagerVO">
		INSERT INTO MANAGER(mno, name, gender, id, pw, tel, email, addr)
		 VALUES(manager_seq.nextval,#{name},#{gender},#{id},#{pw},#{tel},#{email},#{addr})
	</insert>
	<insert id="insertCart" parameterType="ListOrderVO">
		INSERT INTO LIST_ORDER(cno,pno,ocnt)
		 VALUES(#{cno},#{pno},#{ocnt})
	</insert>
	<insert id="insertQustion" parameterType="QuestionVO">
		INSERT INTO QUESTION(qno, cno, qname, qmessage, regdate, cnt)
		 VALUES(question_seq.nextval,#{cno},#{qname},#{qmessage},sysdate,0)
	</insert>
	<insert id="insertCustomer" parameterType="CustomerVO">
		INSERT INTO CUSTOMER(cno, name, gender, id, pw, tel, email, addr)
		 VALUES(customer_seq.nextval,#{name},#{gender},#{id},#{pw},#{tel},#{email},#{addr})
	</insert>
	<insert id="insertOrder" parameterType="hashmap">
		INSERT INTO FINISHED_ORDER(lono,cno,odrdate,addr)
		 VALUES(#{lono},#{cno},sysdate,#{addr})
	</insert>
	<insert id="insertOrders" parameterType="hashmap">
		INSERT INTO ORDERS(ono,lono,pno,ocnt)
		 VALUES(orders_seq.nextval, #{lono}, #{pno}, #{ocnt})
	</insert>
	
	
	
</mapper>